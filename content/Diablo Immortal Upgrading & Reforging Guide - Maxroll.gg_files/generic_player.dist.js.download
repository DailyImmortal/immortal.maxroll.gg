"use strict";function asyncGeneratorStep(e,t,a,r,n,i,l){try{var o=e[i](l),c=o.value}catch(e){return void a(e)}o.done?t(c):Promise.resolve(c).then(r,n)}function _asyncToGenerator(e){return function(){var t=this,a=arguments;return new Promise((function(r,n){var i=e.apply(t,a);function l(e){asyncGeneratorStep(i,r,n,l,o,"next",e)}function o(e){asyncGeneratorStep(i,r,n,l,o,"throw",e)}l(void 0)}))}}var ui={tag:function(e,t,a,r){t=t||{};var n=$("<"+e+">").attr(t);return"function"==typeof a?a((function(e){n.append(e)})):n[r?"text":"append"](a||""),n},tr:function(e,t,a){return ui.tag("tr",e,t,a)},td:function(e,t,a){return ui.tag("td",e,t,a)},div:function(e,t,a){return ui.tag("div",e,t,a)},span:function(e,t,a){return ui.tag("span",e,t,a)},img:function(e,t){return(t=t||{}).src=e||t.src,ui.tag("img",t)},a:function(e,t,a,r){return(t=t||{}).href=e||t.href,ui.tag("a",t,a,r)},input:function(e,t,a,r){return"select"==e?ui.tag("select",Object.assign({name:t},r||{}),a):ui.tag("input",Object.assign({type:e,name:t,value:a},r||{}))}},getLowQuality=e=>0===e.length?null:e.sort((e,t)=>e.bitrate-t.bitrate).reduce((e,t)=>{if(e)return e;if("360p"===t.name)e="360p";else if("480p"===t.name)e="480p";else if(t.name.includes("source"))return t.name;return e},null),isPaused=()=>!!localStorageAvailable()&&!!window.localStorage.getItem("yt_player_paused");function getTwitchPlayer(e,t){var a=new Twitch.Embed("gp-player",{channel:e.user_name,parent:["local.maxroll.gg","test.maxroll.gg","maxroll.gg","d2.maxroll.gg"],layout:t?"video-with-chat":"video"});a.addEventListener(Twitch.Embed.VIDEO_READY,(function(){var e=a.getPlayer();if(e.setMuted(!0),localStorageAvailable()){isPaused()?e.pause():e.play();var t=setInterval(()=>{var t=getLowQuality(e.getQualities());t&&e.setQuality(t)},100);setTimeout(()=>{clearInterval(t)},1e4),a.addEventListener(Twitch.Player.PAUSE,()=>{console.log("Twitch player pause"),window.localStorage.setItem("yt_player_paused","true")}),a.addEventListener(Twitch.Player.PLAYBACK_BLOCKED,()=>{e.setMuted(!0),e.play()}),a.addEventListener(Twitch.Player.PLAY,()=>{console.log("Twitch player unpause"),window.localStorage.removeItem("yt_player_paused")})}}))}function getYoutubePlayer(e){new YT.Player("generic-player",{videoId:e,height:"169",width:"300",events:{onReady:e=>{var t=e.target;t.mute(),isPaused()?t.pauseVideo():t.playVideo()},onStateChange:e=>{switch(e.data){case YT.PlayerState.PAUSED:console.log("Youtube player pause"),window.localStorage.setItem("yt_player_paused","true");break;case YT.PlayerState.PLAYING:console.log("Youtube player play"),window.localStorage.removeItem("yt_player_paused")}}}})}function localStorageAvailable(){try{return window.localStorage.setItem("test","test"),window.localStorage.removeItem("test"),!0}catch(e){return!1}}function scheduleHideVideoAd(e){setTimeout(()=>{jQuery("#ad-wrapper").remove(),jQuery("#generic-player-outer-wrapper").show(),e()},65e3)}function tryPath(e){var t=document.location.pathname;if(t.match(/^\/[a-z]{2}\//i)){var a=t.split(/(\/[a-z]{2}\/)+/i);t="/".concat(a[2])}return!!(t===e||e.substr(0,e.length-1)===t||t.startsWith(e)&&"/"!==e)}function probability(e){var t=e/100;return Math.random()<=t}function gpFallback(){jQuery("#ad-wrapper").show()}function loadCreators(e){return _loadCreators.apply(this,arguments)}function _loadCreators(){return(_loadCreators=_asyncToGenerator((function*(e){try{jQuery("#ad-wrapper").hide();var t=yield fetch("".concat(e),{cache:"no-store"});if(!t.ok)return void console.error("get_content_creators call failed");var a,{data:r}=yield t.json(),n=r.distributionList,i=r.generalSettings,l=r.languageList||null,o=document.location.host,c=document.location.pathname.match(/^\/([a-z]{2})\//i),s=parseInt(i.ads_percentage)||30,d=null,u=!1;if(Object.keys(n).length>0&&!(o in n))return void gpFallback();if(Object.keys(n).length>0){for(var m in n[o])if(a=n[o][m],(!(l&&c&&l[c[1]])||l[c[1]].includes(a.name))&&!0===tryPath(m)){d=a;break}d||(a=n[o].all,l&&c&&l[c[1]]&&l[c[1]].includes(a.name)&&(d=a))}if(d||"/all-streamers"!==document.location.pathname||(d=a,u=!0),!d)return void gpFallback();var p=d&&d.twitch_data.hasOwnProperty("user_name"),h=!1;probability(s)&&s>0||100===s?(jQuery("#ad-wrapper").show(),h=!0):("true"===i.youtube_rotation||p)&&jQuery("#ad-wrapper").hide(),p&&!h?(jQuery("#generic-player-outer-wrapper").show(),getTwitchPlayer(d.twitch_data,u)):"true"===i.youtube_rotation&&d&&d.youtube_video?getYoutubePlayer(d.youtube_video):h=!0,h||jQuery("#ad-wrapper").remove()}catch(e){console.log("Failed to load the generic player"),console.log(e)}}))).apply(this,arguments)}var streamerTemplate=e=>{var{name:t,twitch_data:a,twitch_profile_data:r,twitter:n,online:i}=e,l=i?"online":"offline",o=jQuery.isEmptyObject(a)?"":'<div class="streamer-game">Playing '.concat(a.game_name,"</div>");return'\n        <div class="streamer '.concat(l,'">\n          <div class="image">\n            <a href="https://twitch.tv/').concat(r.login,'" target="_blank">\n              <img src="').concat(r.profile_image_url,'" />\n            </a>\n          </div>\n          <div class="streamer-data">\n            <div class="streamer-wrapper">\n              <div class="streamer-name"><a href="https://twitch.tv/').concat(r.login,'" target="_blank">').concat(t,"</a></div>\n              ").concat(o,'\n            </div>\n          </div>\n          <div class="streamer-socials">\n              <div class="streamer-twitter">\n                <a href="https://twitter.com/').concat(n,'" target="_blank"><span class="twitter icon"></span></a>\n              </div>\n              <div class="streamer-twitch">\n                <a href="https://twitch.tv/').concat(r.login,'" target="_blank"><span class="twitch icon"></span></a>\n              </div>\n          </div>\n        </div>\n        ')};function loadStreamers(e){return _loadStreamers.apply(this,arguments)}function _loadStreamers(){return(_loadStreamers=_asyncToGenerator((function*(e){try{var t=yield fetch("".concat(e),{cache:"no-store"});if(!t.ok)return void console.error("get_content_creators call failed");var{data:a}=yield t.json();jQuery("#streamer-section").html(""),a.length>0&&jQuery("#streamer-section").html(a.map(streamerTemplate).join(""))}catch(e){console.log("Failed to load the generic player"),console.log(e)}}))).apply(this,arguments)}var allStreamers={},onlineStreamers={},allStreamersTemplate=e=>{var{name:t,twitch_data:a,twitch_profile_data:r,twitter:n,online:i}=e,l=i?"online":"offline",o=jQuery.isEmptyObject(a)?"":'<div class="streamer-game">Playing '.concat(a.game_name,"</div>"),c="",s='href="https://twitch.tv/'.concat(r.login,'" target="_blank"');if(i){var d=a.thumbnail_url.replace("{width}","400").replace("{height}","226");c="<div onclick=\"loadStreamer('".concat(t,'\')" class="stream-thumb">\n                <img src="').concat(d,'" alt="stream-thumb">\n            </div>'),s='href="javascript:void(0)" onclick="loadStreamer(\''.concat(t,"')\"")}return'\n        <div class="streamer '.concat(l,'">\n          ').concat(c,'\n          <div class="image">\n            <a ').concat(s,'>\n              <img src="').concat(r.profile_image_url,'" />\n            </a>\n          </div>\n          <div class="streamer-data">\n            <div class="streamer-wrapper">\n              <div class="streamer-name"><a ').concat(s,'">').concat(t,"</a></div>\n              ").concat(o,'\n            </div>\n          </div>\n          <div class="streamer-socials">\n              <div class="streamer-twitter">\n                <a href="https://twitter.com/').concat(n,'" target="_blank"><span class="twitter icon"></span></a>\n              </div>\n              <div class="streamer-twitch">\n                <a href="https://twitch.tv/').concat(r.login,'" target="_blank"><span class="twitch icon"></span></a>\n              </div>\n          </div>\n        </div>\n        ')};function loadStreamer(e){var t=allStreamers[e];jQuery("#gp-player").html("");var a=!1,r=window.matchMedia("(max-width: 1200px)");r.matches||(a=!0),getTwitchPlayer(t.twitch_data,!1,a);var n=function(e){!0===e.matches?(jQuery("#gp-player").html(""),getTwitchPlayer(t.twitch_data,!1,!1)):!1===e.matches&&(jQuery("#gp-player").html(""),getTwitchPlayer(t.twitch_data,!1,!0))};r.removeEventListener("change",n),r.addEventListener("change",n)}function randomOnlineStreamer(){if(0===onlineStreamers.length)return null;var e=Object.keys(onlineStreamers);return onlineStreamers[e[e.length*Math.random()<<0]]}function loadAllStreamers(e){return _loadAllStreamers.apply(this,arguments)}function _loadAllStreamers(){return(_loadAllStreamers=_asyncToGenerator((function*(e){try{var t=yield fetch("".concat(e),{cache:"no-store"});if(!t.ok)return void console.error("get_all_streamers call failed");var{data:a}=yield t.json();if(jQuery("#all-streamer-section").html(""),a.length>0){a.forEach(e=>{allStreamers[e.name]=e,e.online&&(onlineStreamers[e.name]=e)});var r=randomOnlineStreamer();r&&loadStreamer(r.name),jQuery("#all-streamer-section").html('<div class="streamers-header">Now Live</div><div class="online-streamers">'+a.filter(e=>e.online).map(allStreamersTemplate).join("")+'</div><hr class="global-separator"><div class="streamers-header">Offline Creators</div><div class="offline-streamers">'+a.filter(e=>!e.online).map(allStreamersTemplate).join("")+"</div>")}}catch(e){console.log("Failed to load all steamer section"),console.log(e)}}))).apply(this,arguments)}